<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RealMe</title>
  <link rel="icon" href="./src/icon/icon.png" type="image/png" />
  <meta name="theme-color" content="#1F1F1F" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="./src/icon/icon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="./src/styles/base.css" />
  <link rel="stylesheet" href="./src/styles/sobre.css" />
  <link rel="stylesheet" href="./src/styles/amigos.css" />
  <link rel="stylesheet" href="./src/styles/media-queries.css" />
  <link rel="stylesheet" href="./src/styles/navbars.css" />
  <link rel="stylesheet" href="./src/styles/search.css" />
  <link rel="stylesheet" href="./src/styles/post-modal.css" />
  <link rel="stylesheet" href="./src/styles/search.css" />
  <link rel="stylesheet" href="./src/styles/amigos-mobile.css" />
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="logo_area">
      <div class="logo">RealMe</div>
    </div>
    <div class="search-area">
  <div class="search-box">
    <button><i class="fas fa-search"></i></button>
    <input type="text" id="searchInput" placeholder="Buscar" autocomplete="off" />
  </div>
    </div>
    <div class="last-update-area">
      <div class="last-update">
        <p>Novidades!</p>
      </div>
    </div>
    <div class="marquee-container">
      <div class="marquee"></div>
    </div>
  </nav>

   <!-- Sidebar -->
  <aside class="sidebar">
    <a href="feed.html"><i class="fas fa-home"></i> In√≠cio</a>
    <a href="acharamigos.html"><i class="fas fa-user-friends"></i> Achar Amigos</a>
    <a href="direct.html"><i class="fas fa-comments"></i> Mensagens</a>
    <a href="nt.html"><i class="fas fa-bell"></i> Notifica√ß√µes</a>
    <a href="#" class="postmodal"><i class="fas fa-plus-square"></i> Criar</a>
    <a href="#" id="linkPerfilSidebar"><i class="fas fa-user"></i> Perfil</a>
    <div class="more-menu" id="moreMenu">
      <a href="#" class="more-toggle" id="moreToggle">
        <i class="fa-solid fa-bars"></i>
        Mais
      </a>
      <div class="floating-menu" id="floatingMenu">
        <a href="config.html"><i class="fas fa-cog"></i> Configura√ß√µes</a>
        <a href="invites.html"><i class="fa-solid fa-user-plus"></i> Convites</a>
        <a href="como-usar.html"><i class="fa-solid fa-book-open"></i> Como Usar</a>
        <a href="sobre.html"><i class="fas fa-question-circle"></i> Sobre</a>
        <a href="#" id="btnSair"><i class="fas fa-sign-out-alt"></i> Sair</a>
      </div>
    </div>
  </aside>
  <div class="sidebar-overlay"></div>
  <ul id="searchResults"></ul>

  <div class="friends-container">
        <div class="friends-header">
            <div class="view-toggle">
                <button class="toggle-btn active" data-view="carousel">Cards</button>
                <button class="toggle-btn" data-view="grid">Grid</button>
                <button class="toggle-btn filter-btn" id="filterBtn">Buscar</button>
                <a href="map.html">Mapa</a>
            </div>
        </div>

        <!-- VIEW GRID (Original) -->
        <div class="grid-view" id="gridView">
            <div class="friends-list">
                <a class="user" href="#" data-username="afliccoess">
                    <img src="https://lastfm.freetls.fastly.net/i/u/avatar170s/3c04e79db06c605e5de3897555a9a34e.png" alt="Vini demarco">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>Vini demarco</p>
                        </div>
                        <div class="profile-username">
                            <p>@afliccoess</p>
                        </div>
                    </div>
                </a>
                <a class="user" href="#" data-username="vampirinhaz7">
                    <img src="https://cdn.pfps.gg/pfps/1869-goth-egirl-27.png" alt="Mari">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>ñ§çñ§åñ§ç Mari Saverio</p>
                        </div>
                        <div class="profile-username">
                            <p>@vampirinhaz7</p>
                        </div>
                    </div>
                </a>
                <a class="user" href="#" data-username="maxgfortes">
                    <img src="https://i.pinimg.com/736x/d6/fc/2a/d6fc2ab598fdc5ffee863bd5835746c8.jpg" alt="Max">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>maxgfortes</p>
                        </div>
                        <div class="profile-username">
                            <p>@maxgfortes</p>
                        </div>
                    </div>
                </a>
                <a class="user" href="#" data-username="maxine">
                    <img src="https://i.pinimg.com/736x/0e/10/35/0e1035c960796eccbc18608793cfa3e9.jpg" alt="Maxine">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>‚ãÜÀöÔΩ°‚ãÜ‡≠®‚úß‡≠ßÀö ùë¥ùíÇùíôùíäùíèùíÜ Àö‡≠®‚úß‡≠ß‚ãÜÔΩ°Àö‚ãÜ</p>
                        </div>
                        <div class="profile-username">
                            <p>@maxine</p>
                        </div>
                    </div>
                </a>
                <a class="user" href="#" data-username="davix">
                    <img src="https://i.pinimg.com/736x/12/d3/dd/12d3dd5ac7a32f43cf867161cb95774f.jpg" alt="David">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>warrsex</p>
                        </div>
                        <div class="profile-username">
                            <p>@davix</p>
                        </div>
                    </div>
                </a>
                <a class="user" href="#" data-username="haspkey">
                    <img src="https://i.postimg.cc/CK3qy1w5/image.png" alt="Haspkey">
                    <div class="user-name">
                        <div class="profile-name">
                            <p>haspkey</p>
                        </div>
                        <div class="profile-username">
                            <p>@haspkey</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>


  <!-- VIEW CAROUSEL (Novo) -->
        <div class="carousel-view active" id="carouselView">
            <div class="carousel-container">
                <div class="cards-wrapper" id="cardsWrapper">
                    <!-- Cards ser√£o gerados dinamicamente -->
                </div>
            </div>
            <div class="carousel-controls">
                <button class="nav-btn" id="prevBtn">‚Äπ</button>
                <div class="indicators" id="indicators"></div>
                <button class="nav-btn" id="nextBtn">‚Ä∫</button>
            </div>
        </div>
    </div>

<aside class="option-bar">
  <h1>Preferencias</h1>
  <div class="options">
      <!-- Checkbox ‚ÄúIgual a mim‚Äù -->
      <div class="lm">
        <p>Igual a mim</p>
        <label class="switch">
          <input type="checkbox" id="igualAMim">
          <span class="slider"></span>
        </label>
      </div>
  <div class="filtros">
    <div class="estilo">
      <p>Estilo</p>
      <input class="estilo" type="text" placeholder="gotico, alternativo, sk8 archive...">
    </div>

    <div class="estilo">
      <p>Personalidade</p>
      <input class="estilo" type="text" placeholder="extrovertido, introvertido...">
    </div>

    <div class="estilo">
      <p>Medos</p>
      <input class="estilo" type="text" placeholder="Medo de Acabar Sozinho...">
    </div>

    <div class="estilo">
      <p>Sonhos e Desejos</p>
      <input class="estilo" type="text" placeholder="Conex√£o real, Amor, Dinheiro...">
    </div>

    <div class="estilo">
      <p>Musicas</p>
      <input class="estilo" type="text" placeholder="Rock, Grunge, Pop, Alt, Indie...">
    </div>

    <div class="estilo">
      <p>Personagens</p>
      <input class="estilo" type="text" placeholder="Jesse Pinkman, Cassie, Marla...">
    </div>

    <div class="estilo">
      <p>localiza√ß√£o</p>
      <input class="estilo" type="text" placeholder="S√£o Paulo, Porto Alegre...">
    </div>

    <div class="estilo">
      <p>Hobbies</p>
      <input class="estilo" type="text" placeholder="Esportes, Pintura, Musica...">
    </div>

    <div class="selecoes">
      <p>Genero</p>
      <select id="genero">
        <option value="">Qualquer</option>
        <option value="Masculino">Masculino</option>
        <option value="Feminino">Feminino</option>
        <option value="binario">N√£o Binario</option>
      </select>
    </div>

    <div class="selecoes">
      <p>Estado Civil</p>
      <select id="genero">
        <option value="">Namorando</option>
        <option value="Masculino">Solteiro</option>
        <option value="Feminino">Casado</option>
        <option value="binario">Em compromisso</option>
        <option value="binario">Viuvo</option>
      </select>
    </div>

    <div class="selecoes">
      <p>MBTI</p>
      <select id="genero">
        <option value="">ISTJ</option>
        <option value="Masculino">ISFJ</option>
        <option value="Feminino">INFJ</option>
        <option value="binario">INTJ</option>
        <option value="binario">ISTP</option>
        <option value="binario">ISFP</option>
        <option value="binario">INTJ</option>
        <option value="binario">INFP</option>
        <option value="binario">INTP</option>
        <option value="binario">ESTP</option>
        <option value="binario">ESFP</option>
        <option value="binario">ENFP</option>
        <option value="binario">ENTP</option>
        <option value="binario">ESTJ</option>
        <option value="binario">ESFJ</option>
        <option value="binario">ENFJ</option>
        <option value="binario">ENTJ</option>
      </select>
    </div>    
    <div class="age">
      <div class="age-range">
        <p>Idade minima</p>
        <input class="age-input" type="number" id="idade-min" min="13" max="78" value="14">
      </div>
      <div class="age-range">
        <p>Idade Maxima</p>
        <input class="age-input" type="number" id="idade-max" min="13" max="78" step="1" value="17">
      </div>
    </div>

  </div>
  <button class="search-btn" type="submit" form="search-form">Buscar!</button>
</div>

  <!-- Bot√£o fixo -->
  </div>
</aside>
</div>

  <div class="nav-mobile">
      <div class="nav-header"><p>Pessoas parecidas com voc√™</p></div>
  </div>

  <!-- Navbar Bottom -->
  <nav class="navbar-bottom">
    <div class="navbar-bottom-content">
      <a href="feed.html">
        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 511 511.832"><path fill-rule="nonzero" d="M43.084 468.748h116.942V364.721c0-25.882 10.609-49.45 27.679-66.528l.082-.081c17.077-17.07 40.645-27.679 66.527-27.679 25.844 0 49.412 10.617 66.519 27.687l.082.081c17.092 17.151 27.686 40.697 27.686 66.52v104.027h119.315V253.009L255.846 51.151 43.084 253.768v214.98zm138.484 43.084H29.337c-8.09 0-15.428-3.3-20.732-8.605C3.3 497.923 0 490.585 0 482.495V244.611c.059-5.681 2.298-11.346 6.733-15.568L241.038 5.915c8.236-7.846 21.284-7.927 29.616 0l232.514 221.323c4.782 3.957 7.832 9.931 7.832 16.614v238.643c0 7.964-3.316 15.391-8.642 20.717-5.253 5.253-12.591 8.62-20.695 8.62H327.059c-11.891 0-21.542-9.651-21.542-21.542V364.721c0-14.109-5.739-26.913-14.978-36.145l-.081-.081c-9.231-9.238-22.036-14.978-36.144-14.978-14.087 0-26.913 5.762-36.189 15.015-9.253 9.276-15.014 22.102-15.014 36.189V490.29c0 11.891-9.652 21.542-21.543 21.542z"/></svg>
      </a>
      <a href="acharamigos.html">
<svg width="800px" height="800px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
  <g clip-path="url(#clip0_1251_98416)">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M9 0C5.96243 0 3.5 2.46243 3.5 5.5C3.5 8.53757 5.96243 11 9 11C12.0376 11 14.5 8.53757 14.5 5.5C14.5 2.46243 12.0376 0 9 0ZM5.5 5.5C5.5 3.567 7.067 2 9 2C10.933 2 12.5 3.567 12.5 5.5C12.5 7.433 10.933 9 9 9C7.067 9 5.5 7.433 5.5 5.5Z" />
    <path d="M15.5 0C14.9477 0 14.5 0.447715 14.5 1C14.5 1.55228 14.9477 2 15.5 2C17.433 2 19 3.567 19 5.5C19 7.433 17.433 9 15.5 9C14.9477 9 14.5 9.44771 14.5 10C14.5 10.5523 14.9477 11 15.5 11C18.5376 11 21 8.53757 21 5.5C21 2.46243 18.5376 0 15.5 0Z" />
    <path d="M19.0837 14.0157C19.3048 13.5096 19.8943 13.2786 20.4004 13.4997C22.5174 14.4246 24 16.538 24 19V21C24 21.5523 23.5523 22 23 22C22.4477 22 22 21.5523 22 21V19C22 17.3613 21.0145 15.9505 19.5996 15.3324C19.0935 15.1113 18.8625 14.5217 19.0837 14.0157Z"/>
    <path d="M6 13C2.68629 13 0 15.6863 0 19V21C0 21.5523 0.447715 22 1 22C1.55228 22 2 21.5523 2 21V19C2 16.7909 3.79086 15 6 15H12C14.2091 15 16 16.7909 16 19V21C16 21.5523 16.4477 22 17 22C17.5523 22 18 21.5523 18 21V19C18 15.6863 15.3137 13 12 13H6Z"/>
  </g>
  <defs>
    <clipPath id="clip0_1251_98416">
      <rect width="24" height="24" fill="white"/>
    </clipPath>
  </defs>
  <ellipse cx="9.203" cy="5.686" rx="3.974" ry="3.89"/>
  <ellipse cx="8.949" cy="17.693" rx="7.948" ry="3.129"/>
  <rect x="0.905" y="19.066" width="16.105" height="2.921" />
  <path  d="M 20.053 8.503 C 17.494 6.721 18.686 0.235 20.239 0.238 C 13.183 0.005 11.847 9.09 19.424 9.531" transform="matrix(-1, 0, 0, -1, 34.50581791, 9.88500966)"/>
  <path style=" stroke-width: 1; transform-box: fill-box; transform-origin: 50% 50%;" d="M 23.81 21.114 C 22.291 19.332 21.826 13.844 22.748 13.847 C 17.069 12.341 18.308 21.348 22.696 22.017" transform="matrix(-1, 0, 0, -1, -0.000002, 0)"/>
  <rect x="21.158" y="20.873" width="1.996" height="1.123" />
</svg>
      </a>
      <a href="direct-mobile.html">
        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 506 511.682"><path fill-rule="nonzero" d="M76.022 432.762c-14.224-17.624-28.477-36.009-40.468-55.504-13.738-22.329-24.838-46.442-30.326-73.172-14.057-68.387.935-136.064 36.561-190.148C77.414 59.833 133.687 19.322 202.118 5.235c68.394-14.071 136.056.928 190.14 36.547 54.105 35.632 94.638 91.912 108.71 160.35 7.003 34.067 6.445 67.452-.116 99.01-7.018 33.734-20.937 65.408-39.78 93.639-25.671 38.445-58.723 65.581-98.51 82.009-39.837 16.45-86.054 21.88-138.014 16.979l-9.714-.928c-19.966-1.928-27.528-2.653-33.487-1.094-4.343 1.181-9.932 3.69-18.842 7.677l-8.381 3.734c-20.756 9.229-36.009 10.44-47.878 6.14-15.499-5.618-22.503-17.566-25.765-33.023-1.624-7.706-2.139-15.739-2.675-24.221-.399-6.445-.841-13.231-1.784-19.292zm47.972-127.857l61.768-98.785c10.976-16.573 33.719-20.177 49.357-7.924l52.024 40.917c4.785 3.734 11.469 3.886 16.363.319l66.038-46.413c9.678-7.032 21.873 4.698 15.297 14.681l-62.355 97.785c-10.977 16.566-33.719 20.176-49.357 7.917l-52.024-40.918c-4.785-3.734-11.462-3.893-16.363-.319l-65.509 47.37c-9.671 7.032-21.872-4.64-15.239-14.63zM74.761 353.16c11.976 19.473 26.273 37.597 40.323 54.902a22.782 22.782 0 014.785 9.693c2.501 10.962 3.175 21.532 3.799 31.428.384 6.104.754 11.919 1.493 16.232 2.226-.775 5.633-2.16 10.462-4.299l8.177-3.596c11.23-5.031 18.284-8.192 25.679-10.164h.094c13.688-3.646 23.49-2.711 49.581-.188l9.716.928c44.484 4.197 83.43-.196 116.25-13.746 31.246-12.905 57.36-34.444 77.833-65.103 15.616-23.395 27.144-49.596 32.936-77.457 5.336-25.686 5.8-52.822.116-80.48-11.52-56.026-44.673-102.084-88.919-131.221-44.274-29.158-99.72-41.432-155.79-29.891-56.012 11.528-102.07 44.674-131.199 88.912-29.166 44.282-41.433 99.728-29.906 155.798 4.205 20.495 13.246 39.852 24.57 58.252z"/></svg>
      </a>
      <a href="explorar.html">
        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 512 510.784"><path fill-rule="nonzero" d="M217.587 0c60.082 0 114.478 24.36 153.849 63.73 39.371 39.371 63.731 93.782 63.731 153.857 0 52.338-18.484 100.353-49.276 137.893l119.914 119.387c8.228 8.183 8.264 21.495.081 29.722s-21.495 8.264-29.722.081l-119.93-119.395c-37.641 31.166-85.957 49.892-138.647 49.892-60.075 0-114.486-24.36-153.857-63.731C24.36 332.065 0 277.669 0 217.587 0 157.512 24.36 103.101 63.73 63.73 103.101 24.36 157.512 0 217.587 0zm124.046 93.533c-31.737-31.737-75.605-51.379-124.046-51.379-48.448 0-92.317 19.642-124.054 51.379-31.737 31.737-51.379 75.606-51.379 124.054 0 48.441 19.642 92.309 51.379 124.046 31.737 31.737 75.606 51.379 124.054 51.379 48.441 0 92.309-19.642 124.046-51.379 31.737-31.737 51.379-75.605 51.379-124.046 0-48.448-19.642-92.317-51.379-124.054z"/></svg>
      </a>
      <a href="pfmobile.html">
        <img src="./src/icon/default.jpg" alt="Perfil" class="profile-mini">
      </a>
    </div>
  </nav>

<script src="./src/js/postmodal.js"></script>
<script src="./src/js/more.js"></script>


<script>
        // Dados dos usu√°rios
        const users = [
            {
                name: "Vini demarco",
                username: "@afliccoess",
                image: "https://lastfm.freetls.fastly.net/i/u/avatar170s/3c04e79db06c605e5de3897555a9a34e.png",
                profile: "PF.html?username=afliccoess"
            },
            {
                name: "ñ§çñ§åñ§ç Mari Saverio",
                username: "@vampirinhaz7",
                image: "https://cdn.pfps.gg/pfps/1869-goth-egirl-27.png",
                profile: "PF.html?username=vampirinhaz7"
            },
            {
                name: "maxgfortes",
                username: "@maxgfortes",
                image: "https://i.pinimg.com/736x/d6/fc/2a/d6fc2ab598fdc5ffee863bd5835746c8.jpg",
                profile: "PF.html?username=maxgfortes"
            },
            {
                name: "‚ãÜÀöÔΩ°‚ãÜ‡≠®‚úß‡≠ßÀö ùë¥ùíÇùíôùíäùíèùíÜ Àö‡≠®‚úß‡≠ß‚ãÜÔΩ°Àö‚ãÜ",
                username: "@maxine",
                image: "https://i.pinimg.com/736x/0e/10/35/0e1035c960796eccbc18608793cfa3e9.jpg",
                profile: "PF.html?username=maxine"
            },
            {
                name: "warrsex",
                username: "@davix",
                image: "https://i.pinimg.com/736x/12/d3/dd/12d3dd5ac7a32f43cf867161cb95774f.jpg",
                profile: "PF.html?username=davix"
            },
            {
                name: "haspkey",
                username: "@haspkey",
                image: "https://i.postimg.cc/CK3qy1w5/image.png",
                profile: "PF.html?username=haspkey"
            },
            {
                name: "haspkey",
                username: "@haspkey",
                image: "https://i.postimg.cc/CK3qy1w5/image.png",
                profile: "PF.html?username=haspkey"
            },
            {
                name: "haspkey",
                username: "@haspkey",
                image: "https://i.postimg.cc/CK3qy1w5/image.png",
                profile: "PF.html?username=haspkey"
            },
            {
                name: "haspkey",
                username: "@haspkey",
                image: "https://i.postimg.cc/CK3qy1w5/image.png",
                profile: "PF.html?username=haspkey"
            }
        ];

        class FriendsCarousel {
            constructor() {
                this.currentIndex = 0;
                this.users = users;
                this.cardsWrapper = document.getElementById('cardsWrapper');
                this.indicators = document.getElementById('indicators');
                this.isTransitioning = false;
                
                this.init();
            }

            init() {
                this.createCards();
                this.createIndicators();
                this.bindEvents();
                this.updateDisplay();
            }

            createCards() {
                this.cardsWrapper.innerHTML = '';
                this.users.forEach((user, index) => {
                    const card = document.createElement('div');
                    card.className = 'friend-card';
                    card.innerHTML = `
                        <div class="card-content">
                            <img src="${user.image}" alt="${user.name}" class="card-image">
                            <div class="card-info">
                                <div class="card-name">${user.name}</div>
                                <div class="card-username">${user.username}</div>
                            </div>
                            <a href="${user.profile}" class="view-profile-btn"><p>Ver Perfil</p>
                            </a>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.view-profile-btn')) {
                            this.goToSlide(index);
                        }
                    });
                    this.cardsWrapper.appendChild(card);
                });
            }

            createIndicators() {
                this.indicators.innerHTML = '';
                this.users.forEach((_, index) => {
                    const indicator = document.createElement('div');
                    indicator.className = 'indicator';
                    if (index === 0) indicator.classList.add('active');
                    indicator.addEventListener('click', () => {
                        this.goToSlide(index);
                    });
                    this.indicators.appendChild(indicator);
                });
            }

            updateDisplay() {
                const cards = this.cardsWrapper.children;
                const totalCards = cards.length;

                Array.from(cards).forEach(card => {
                    card.classList.remove('center', 'left', 'right', 'far-left', 'far-right', 'hidden');
                });

                Array.from(cards).forEach((card, index) => {
                    const relativePos = this.getRelativePosition(index, this.currentIndex, totalCards);
                    switch (relativePos) {
                        case 0: card.classList.add('center'); break;
                        case 1: card.classList.add('right'); break;
                        case -1: card.classList.add('left'); break;
                        case 2: card.classList.add('far-right'); break;
                        case -2: card.classList.add('far-left'); break;
                        default: card.classList.add('hidden'); break;
                    }
                });

                // Corrige as bolinhas para sempre mostrar todas e ativar a correta
                const indicatorElements = this.indicators.children;
                Array.from(indicatorElements).forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === this.currentIndex);
                });
            }

            // Corrige o c√°lculo para sempre ser infinito
            getRelativePosition(cardIndex, currentIndex, totalCards) {
                let diff = cardIndex - currentIndex;
                // Mant√©m o carrossel infinito sem pular bolinhas
                if (diff > totalCards / 2) {
                    diff -= totalCards;
                } else if (diff < -totalCards / 2) {
                    diff += totalCards;
                }
                return diff;
            }

            goToSlide(index) {
                if (this.isTransitioning || index === this.currentIndex) return;
                this.isTransitioning = true;
                this.currentIndex = index;
                this.updateDisplay();
                setTimeout(() => {
                    this.isTransitioning = false;
                }, 400);
            }

            next() {
                this.currentIndex = (this.currentIndex + 1) % this.users.length;
                this.updateDisplay();
            }

            prev() {
                this.currentIndex = (this.currentIndex - 1 + this.users.length) % this.users.length;
                this.updateDisplay();
            }

            bindEvents() {
                document.getElementById('nextBtn').addEventListener('click', () => this.next());
                document.getElementById('prevBtn').addEventListener('click', () => this.prev());
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('carouselView').classList.contains('active')) {
                        if (e.key === 'ArrowRight') this.next();
                        if (e.key === 'ArrowLeft') this.prev();
                    }
                });
            }
        }

        // Toggle entre views
        class ViewToggle {
            constructor() {
                this.currentView = 'carousel';
                this.init();
            }

            init() {
                const toggleButtons = document.querySelectorAll('.toggle-btn');
                toggleButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const viewType = btn.dataset.view;
                        this.switchView(viewType);
                        toggleButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                });
            }

            switchView(viewType) {
                const gridView = document.getElementById('gridView');
                const carouselView = document.getElementById('carouselView');
                if (viewType === 'grid') {
                    gridView.classList.add('active');
                    carouselView.classList.remove('active');
                    this.currentView = 'grid';
                } else {
                    carouselView.classList.add('active');
                    gridView.classList.remove('active');
                    this.currentView = 'carousel';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const carousel = new FriendsCarousel();
            const viewToggle = new ViewToggle();
            console.log('Sistema de amigos inicializado!');

            // Bot√£o de filtros para mobile
            const filterBtn = document.getElementById('filterBtn');
            const optionBar = document.querySelector('.option-bar');
            const overlay = document.querySelector('.sidebar-overlay');

            if (filterBtn && optionBar && overlay) {
                filterBtn.addEventListener('click', () => {
                    optionBar.classList.add('open');
                    overlay.classList.add('show');
                });

                overlay.addEventListener('click', () => {
                    optionBar.classList.remove('open');
                    overlay.classList.remove('show');
                });
            }
        });
</script>
<script type="module">
// ===============================
//  acharAmigos.js
//  Busca usu√°rios semelhantes no Firestore por pontos de similaridade
// ===============================

// Fun√ß√£o para detectar mobile e redirecionar corretamente
function getProfileUrl(userId) {
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  return isMobile ? `pfmobile.html?userid=${userId}` : `PF.html?userid=${userId}`;
}

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyB2N41DiH0-Wjdos19dizlWSKOlkpPuOWs",
  authDomain: "ifriendmatch.firebaseapp.com",
  projectId: "ifriendmatch",
  storageBucket: "ifriendmatch.appspot.com",
  messagingSenderId: "306331636603",
  appId: "1:306331636603:web:c0ae0bd22501803995e3de",
  measurementId: "G-D96BEW6RC3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUserId = null;
onAuthStateChanged(auth, (user) => {
  if (user) currentUserId = user.uid;
});

const btnBuscar = document.querySelector('.search-btn');
const switchIgualAMim = document.getElementById('igualAMim');
const filtrosInputs = document.querySelectorAll('.filtros input, .filtros select');
const cardsWrapper = document.getElementById('cardsWrapper');
const friendsList = document.querySelector('.friends-list'); // grid view

function normalizar(str) {
  return (str || "").normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

if (btnBuscar) btnBuscar.addEventListener('click', buscarUsuariosSemelhantes);
if (switchIgualAMim) switchIgualAMim.addEventListener('change', alternarIgualAMim);

async function alternarIgualAMim() {
  if (switchIgualAMim.checked) {
    filtrosInputs.forEach(el => {
      el.disabled = true;
      el.classList.add('cinza');
    });
    await preencherComDadosDoUsuarioAtual();
  } else {
    filtrosInputs.forEach(el => {
      el.disabled = false;
      el.classList.remove('cinza');
      el.value = '';
    });
  }
}

async function preencherComDadosDoUsuarioAtual() {
  if (!currentUserId) return;
  const userRef = doc(db, "users", currentUserId);
  const userSnap = await getDoc(userRef);
  const mediaRef = doc(db, "users", currentUserId, "user-infos", "user-media");
  const aboutRef = doc(db, "users", currentUserId, "user-infos", "about");
  const likesRef = doc(db, "users", currentUserId, "user-infos", "likes");
  const [mediaSnap, aboutSnap, likesSnap] = await Promise.all([
    getDoc(mediaRef), getDoc(aboutRef), getDoc(likesRef)
  ]);
  const userData = userSnap.exists() ? userSnap.data() : {};
  const media = mediaSnap.exists() ? mediaSnap.data() : {};
  const about = aboutSnap.exists() ? aboutSnap.data() : {};
  const likes = likesSnap.exists() ? likesSnap.data() : {};

  filtrosInputs.forEach(input => {
    const label = input.previousElementSibling?.textContent?.toLowerCase() || '';
    if (label.includes('estilo')) input.value = about.styles || '';
    if (label.includes('personalidade')) input.value = about.personality || '';
    if (label.includes('medo')) input.value = about.fears || '';
    if (label.includes('sonho')) input.value = about.dreams || '';
    if (label.includes('musica')) input.value = likes.music || '';
    if (label.includes('personagem')) input.value = likes.characters || '';
    if (label.includes('hobbies')) input.value = likes.hobbies || '';
    if (label.includes('local')) input.value = userData.location || userData.localizacao || '';
    if (label.includes('genero')) input.value = userData.gender || '';
    if (label.includes('estado civil')) input.value = userData.maritalStatus || '';
    if (label.includes('mbti')) input.value = userData.MBTI || userData.mbti || '';
    if (input.classList.contains('age-input')) {
      if (userData.nascimento) {
        const nasc = new Date(userData.nascimento);
        const hoje = new Date();
        const idade = hoje.getFullYear() - nasc.getFullYear();
        input.value = idade;
      }
    }
  });
}

function mostrarLoading() {
  if (cardsWrapper) {
    cardsWrapper.innerHTML = `
      <div class="loading-spinner">
        <div class="spinner-center">
          <div class="spinner"></div>
          <p>Carregando pessoas...</p>
        </div>
      </div>
    `;
  }
  if (friendsList) {
    friendsList.innerHTML = `
      <div class="loading-spinner">
        <div class="spinner-center">
          <div class="spinner"></div>
          <p>Carregando pessoas...</p>
        </div>
      </div>
    `;
  }
}

function removerLoading() {
  if (cardsWrapper) {
    const spinner = cardsWrapper.querySelector('.loading-spinner');
    if (spinner) spinner.remove();
  }
  if (friendsList) {
    const spinner = friendsList.querySelector('.loading-spinner');
    if (spinner) spinner.remove();
  }
}

let cacheUltimosUsuarios = [];
let carouselInstance = null;

function renderizarResultados(resultados) {
  if (!cardsWrapper) return;
  cardsWrapper.innerHTML = '';
  if (!resultados.length) {
    cardsWrapper.innerHTML = '<p>Nenhum usu√°rio parecido encontrado.</p>';
    return;
  }

  // Remove duplicados pelo id
  const vistos = new Set();
  const resultadosUnicos = resultados.filter(u => {
    if (vistos.has(u.id)) return false;
    vistos.add(u.id);
    return true;
  });

  resultadosUnicos.forEach(u => {
    const card = document.createElement('div');
    card.className = 'friend-card';
    card.innerHTML = `
      <div class="card-content">
        <img src="${u.userphoto}" alt="${u.displayname}" class="card-image">
        <div class="card-info">
          <div class="card-name">${u.displayname}</div>
          <div class="card-username">@${u.username}</div>
        </div>
        <a href="${getProfileUrl(u.id)}" class="view-profile-btn">
          <p>Ver Perfil</p>
        </a>
        <p class="similarity">Compatibilidade: ${(u.score * 100).toFixed(0)}%</p>
      </div>
    `;
    cardsWrapper.appendChild(card);
  });

  // Salva no cache
  cacheUltimosUsuarios = resultadosUnicos.slice(0, 20);
  localStorage.setItem('ultimosUsuarios', JSON.stringify(cacheUltimosUsuarios));

  // Atualiza o carrossel com os dados buscados
  if (carouselInstance) {
    const users = resultadosUnicos.map(u => ({
      name: u.displayname,
      username: '@' + u.username,
      image: u.userphoto,
      profile: `PF.html?userid=${u.id}`
    }));
    carouselInstance.setUsers(users);
  }
}

function renderizarGrid(resultados) {
  if (!friendsList) return;
  friendsList.innerHTML = '';
  if (!resultados.length) {
    friendsList.innerHTML = '<p>Nenhum usu√°rio parecido encontrado.</p>';
    return;
  }

  // Remove duplicados pelo id
  const vistos = new Set();
  const resultadosUnicos = resultados.filter(u => {
    if (vistos.has(u.id)) return false;
    vistos.add(u.id);
    return true;
  });

  resultadosUnicos.forEach(u => {
    const userEl = document.createElement('a');
    userEl.className = 'user';
    userEl.href = getProfileUrl(u.id);
    userEl.setAttribute('data-username', u.username);
    userEl.innerHTML = `
      <img src="${u.userphoto}" alt="${u.displayname}">
      <div class="user-name">
        <div class="profile-name">
          <p>${u.displayname}</p>
        </div>
        <div class="profile-username">
          <p>@${u.username}</p>
        </div>
        <div style="font-size:12px;color:#4e8cff;">Compatibilidade: ${(u.score * 100).toFixed(0)}%</div>
      </div>
    `;
    friendsList.appendChild(userEl);
  });

  // Salva no cache
  cacheUltimosUsuarios = resultadosUnicos.slice(0, 20);
  localStorage.setItem('ultimosUsuarios', JSON.stringify(cacheUltimosUsuarios));
}

// Exibe cache ao carregar a p√°gina
document.addEventListener('DOMContentLoaded', () => {
  carouselInstance = new FriendsCarousel();
  carouselInstance.bindEvents();
  const cache = localStorage.getItem('ultimosUsuarios');
  if (cache) {
    const usuarios = JSON.parse(cache);
    renderizarResultados(usuarios);
    renderizarGrid(usuarios);
  }
  const viewToggle = new ViewToggle();
  console.log('Sistema de amigos inicializado!');
});

async function buscarUsuariosSemelhantes() {

  // FECHA OS FILTROS
  const optionBar = document.querySelector('.option-bar');
  const overlay = document.querySelector('.sidebar-overlay');
  if (optionBar && overlay) {
    optionBar.classList.remove('open');
    overlay.classList.remove('show');
  }

  // TROCA PARA VIEW DE GRID COMO PADR√ÉO
  const gridBtn = document.querySelector('[data-view="grid"]');
  if (gridBtn) gridBtn.click();


  mostrarLoading();
  const filtros = coletarFiltros();
  const usersRef = collection(db, 'users');
  const snapshot = await getDocs(usersRef);
  const resultados = [];

  for (const docSnap of snapshot.docs) {
    const userId = docSnap.id;
    if (userId === currentUserId) continue;

    const userData = docSnap.data();
    const mediaRef = doc(db, "users", userId, "user-infos", "user-media");
    const aboutRef = doc(db, "users", userId, "user-infos", "about");
    const likesRef = doc(db, "users", userId, "user-infos", "likes");
    const [mediaSnap, aboutSnap, likesSnap] = await Promise.all([
      getDoc(mediaRef), getDoc(aboutRef), getDoc(likesRef)
    ]);
    const media = mediaSnap.exists() ? mediaSnap.data() : {};
    const about = aboutSnap.exists() ? aboutSnap.data() : {};
    const likes = likesSnap.exists() ? likesSnap.data() : {};

    // Junta todos os dados relevantes
    const perfil = {
      ...userData,
      ...media,
      ...about,
      ...likes
    };

    // Calcula idade
    let idade = null;
    if (perfil.nascimento) {
      const nasc = new Date(perfil.nascimento);
      const hoje = new Date();
      idade = hoje.getFullYear() - nasc.getFullYear();
    }

    // Calcula score de similaridade
    const score = calcularSimilaridadeCampos(perfil, filtros, idade);

    if (score > 0) {
      resultados.push({
        id: userId,
        displayname: perfil.displayname || perfil.username || perfil.name || 'Usu√°rio',
        username: perfil.username || '',
        userphoto: perfil.userphoto || './src/icon/default.jpg',
        score
      });
      // Mostra incremental
      resultados.sort((a, b) => b.score - a.score);
      renderizarResultados(resultados);
      renderizarGrid(resultados);
    }
  }

  removerLoading();
  resultados.sort((a, b) => b.score - a.score);
  renderizarResultados(resultados);
  renderizarGrid(resultados);
  if (!resultados.length) {
    if (cardsWrapper) cardsWrapper.innerHTML = '<p>Nenhum usu√°rio parecido encontrado.</p>';
    if (friendsList) friendsList.innerHTML = '<p>Nenhum usu√°rio parecido encontrado.</p>';
  }
}

function coletarFiltros() {
  const filtros = {};
  filtrosInputs.forEach(el => {
    const label = el.previousElementSibling?.textContent?.trim().toLowerCase() || el.id;
    filtros[label] = el.value.trim().toLowerCase();
  });
  filtros['idade-minima'] = document.getElementById('idade-min')?.value || '';
  filtros['idade-maxima'] = document.getElementById('idade-max')?.value || '';
  return filtros;
}

function calcularSimilaridadeCampos(perfil, filtros, idade) {
  let score = 0;
  let campos = 0;

  // Permite m√∫ltiplos termos separados por v√≠rgula ou espa√ßo
  function termosFiltro(valor) {
    if (!valor) return [];
    return valor.split(',').map(t => t.trim()).filter(Boolean).flatMap(t => t.split(' ')).filter(Boolean);
  }

  // Estilo
  if (filtros['estilo']) {
    const termos = termosFiltro(filtros['estilo']);
    const campo = normalizar(perfil.styles || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Personalidade
  if (filtros['personalidade']) {
    const termos = termosFiltro(filtros['personalidade']);
    const campo = normalizar(perfil.personality || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Medos
  if (filtros['medos']) {
    const termos = termosFiltro(filtros['medos']);
    const campo = normalizar(perfil.fears || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Sonhos
  if (filtros['sonhos e desejos']) {
    const termos = termosFiltro(filtros['sonhos e desejos']);
    const campo = normalizar(perfil.dreams || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Musicas
  if (filtros['musicas']) {
    const termos = termosFiltro(filtros['musicas']);
    const campo = normalizar(perfil.music || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Personagens
  if (filtros['personagens']) {
    const termos = termosFiltro(filtros['personagens']);
    const campo = normalizar(perfil.characters || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Hobbies
  if (filtros['hobbies']) {
    const termos = termosFiltro(filtros['hobbies']);
    const campo = normalizar(perfil.hobbies || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Localiza√ß√£o
  if (filtros['localiza√ß√£o']) {
    const termos = termosFiltro(filtros['localiza√ß√£o']);
    const campo = normalizar(perfil.location || perfil.localizacao || '');
    if (termos.some(t => campo.includes(normalizar(t)))) score += 2;
    campos++;
  }
  // Genero
  if (filtros['genero']) {
    const termos = termosFiltro(filtros['genero']);
    const campo = normalizar(perfil.gender || '');
    if (termos.some(t => campo === normalizar(t))) score += 2;
    campos++;
  }
  // Estado Civil
  if (filtros['estado civil']) {
    const termos = termosFiltro(filtros['estado civil']);
    const campo = normalizar(perfil.maritalStatus || '');
    if (termos.some(t => campo === normalizar(t))) score += 2;
    campos++;
  }
  // MBTI
  if (filtros['mbti']) {
    const termos = termosFiltro(filtros['mbti']);
    const campo = normalizar(perfil.MBTI || perfil.mbti || '');
    if (termos.some(t => campo === normalizar(t))) score += 2;
    campos++;
  }
  // Idade
  if (filtros['idade-minima'] || filtros['idade-maxima']) {
    const min = parseInt(filtros['idade-minima']) || 0;
    const max = parseInt(filtros['idade-maxima']) || 200;
    if (idade !== null && idade >= min && idade <= max) score += 2;
    campos++;
  }

  // Busca por palavras-chave em todos os textos do usu√°rio
  const palavrasFiltro = Object.values(filtros)
    .filter(Boolean)
    .flatMap(termosFiltro)
    .map(normalizar);

  const textoUsuario = [
    perfil.bio || '',
    perfil.displayname || '',
    perfil.username || '',
    perfil.name || '',
    perfil.surname || '',
    perfil.music || '',
    perfil.hobbies || '',
    perfil.characters || '',
    perfil.dreams || '',
    perfil.fears || '',
    perfil.location || '',
    perfil.localizacao || '',
    perfil.tags || '',
    perfil.books || '',
    perfil.foods || '',
    perfil.games || '',
    perfil.movies || '',
    perfil.overview || '',
    perfil.others || ''
  ].join(' ').toLowerCase();

  palavrasFiltro.forEach(palavra => {
    if (textoUsuario.includes(palavra)) score += 1;
  });

  return campos ? score / campos : 0;
}

// Carrossel din√¢mico
class FriendsCarousel {
    constructor() {
        this.currentIndex = 0;
        this.users = [];
        this.cardsWrapper = document.getElementById('cardsWrapper');
        this.indicators = document.getElementById('indicators');
        this.isTransitioning = false;
    }

    setUsers(newUsers) {
        // Remove duplicados pelo profile (url) ou username
        const vistos = new Set();
        this.users = newUsers.filter(u => {
            const key = u.profile || u.username;
            if (vistos.has(key)) return false;
            vistos.add(key);
            return true;
        });
        this.currentIndex = 0;
        this.createCards();
        this.createIndicators();
        this.updateDisplay();
    }

    createCards() {
        this.cardsWrapper.innerHTML = '';
        this.users.forEach((user, index) => {
            const card = document.createElement('div');
            card.className = 'friend-card';
            card.innerHTML = `
                <div class="card-content">
                    <img src="${user.image}" alt="${user.name}" class="card-image">
                    <div class="card-info">
                        <div class="card-name">${user.name}</div>
                        <div class="card-username">${user.username}</div>
                    </div>
                    <a href="${user.profile}" class="view-profile-btn"><p>Ver Perfil</p>
                    </a>
                </div>
            `;
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.view-profile-btn')) {
                    this.goToSlide(index);
                }
            });
            this.cardsWrapper.appendChild(card);
        });
    }

    createIndicators() {
        this.indicators.innerHTML = '';
        this.users.forEach((_, index) => {
            const indicator = document.createElement('div');
            indicator.className = 'indicator';
            if (index === 0) indicator.classList.add('active');
            indicator.addEventListener('click', () => {
                this.goToSlide(index);
            });
            this.indicators.appendChild(indicator);
        });
    }

    updateDisplay() {
        const cards = this.cardsWrapper.children;
        const totalCards = cards.length;

        Array.from(cards).forEach(card => {
            card.classList.remove('center', 'left', 'right', 'far-left', 'far-right', 'hidden');
        });

        Array.from(cards).forEach((card, index) => {
            const relativePos = this.getRelativePosition(index, this.currentIndex, totalCards);
            switch (relativePos) {
                case 0: card.classList.add('center'); break;
                case 1: card.classList.add('right'); break;
                case -1: card.classList.add('left'); break;
                case 2: card.classList.add('far-right'); break;
                case -2: card.classList.add('far-left'); break;
                default: card.classList.add('hidden'); break;
            }
        });

        // Corrige as bolinhas para sempre mostrar todas e ativar a correta
        const indicatorElements = this.indicators.children;
        Array.from(indicatorElements).forEach((indicator, index) => {
            indicator.classList.toggle('active', index === this.currentIndex);
        });
    }

    getRelativePosition(cardIndex, currentIndex, totalCards) {
        let diff = cardIndex - currentIndex;
        if (diff > totalCards / 2) {
            diff -= totalCards;
        } else if (diff < -totalCards / 2) {
            diff += totalCards;
        }
        return diff;
    }

    goToSlide(index) {
        if (this.isTransitioning || index === this.currentIndex) return;
        this.isTransitioning = true;
        this.currentIndex = index;
        this.updateDisplay();
        setTimeout(() => {
            this.isTransitioning = false;
        }, 400);
    }

    next() {
        this.currentIndex = (this.currentIndex + 1) % this.users.length;
        this.updateDisplay();
    }

    prev() {
        this.currentIndex = (this.currentIndex - 1 + this.users.length) % this.users.length;
        this.updateDisplay();
    }

    bindEvents() {
        document.getElementById('nextBtn').addEventListener('click', () => this.next());
        document.getElementById('prevBtn').addEventListener('click', () => this.prev());
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('carouselView').classList.contains('active')) {
                if (e.key === 'ArrowRight') this.next();
                if (e.key === 'ArrowLeft') this.prev();
            }
        });
        
    }
}

// Toggle entre views
class ViewToggle {
    constructor() {
        this.currentView = 'carousel';
        this.init();
    }

    init() {
        const toggleButtons = document.querySelectorAll('.toggle-btn');
        toggleButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const viewType = btn.dataset.view;
                this.switchView(viewType);
                toggleButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
    }

    switchView(viewType) {
        const gridView = document.getElementById('gridView');
        const carouselView = document.getElementById('carouselView');
        if (viewType === 'grid') {
            gridView.classList.add('active');
            carouselView.classList.remove('active');
            this.currentView = 'grid';
        } else {
            carouselView.classList.add('active');
            gridView.classList.remove('active');
            this.currentView = 'carousel';
        }
    }
}

// Spinner CSS
const style = document.createElement('style');
style.innerHTML = `
.loading-spinner {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(30,30,30,0.8);
  border-radius: 12px;
  padding: 24px 32px;
}

.cinza {
  background: #222 !important;
  color: #aaa !important;
  border-color: #333 !important;
  opacity: 1 !important;
}

.cinza::placeholder {
  color: #333 !important;
}

.spinner-center {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.spinner {
  width: 48px;
  height: 48px;
  border: 6px solid #ccc;
  border-top: 6px solid #4e8cff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 12px;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
`;
document.head.appendChild(style);

async function atualizarMarqueeUltimoUsuario() {
  const lastUpdateRef = doc(db, "lastupdate", "latestUser");
  const docSnap = await getDoc(lastUpdateRef);
  const marquee = document.querySelector(".marquee");
  if (!marquee) return;
  if (docSnap.exists()) {
    const data = docSnap.data();
    const nomeUsuario = data.username || "Usu√°rio";
    marquee.textContent = `${nomeUsuario} acabou de entrar no RealMe!`;
  } else {
    marquee.textContent = "Bem-vindo ao RealMe!";
  }
}

document.addEventListener('DOMContentLoaded', atualizarMarqueeUltimoUsuario);

// Bot√£o para fechar modal de prefer√™ncias em mobile
document.addEventListener('DOMContentLoaded', () => {
  const optionBar = document.querySelector('.option-bar');
  const overlay = document.querySelector('.sidebar-overlay');
  
  if (optionBar && overlay) {
    // Cria o bot√£o de fechar
    const closeBtn = document.createElement('button');
    closeBtn.className = 'close-preferences-btn';
    closeBtn.innerHTML = '<i class="fas fa-times"></i> Fechar';
    closeBtn.style.cssText = `
      position: sticky;
      top: 10px;
      right: 10px;
      background: #dc3545;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      z-index: 3001;
      margin-bottom: 20px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    `;
    
    // Adiciona o bot√£o no topo da barra
    const h1 = optionBar.querySelector('h1');
    if (h1) {
      h1.insertAdjacentElement('afterend', closeBtn);
    } else {
      optionBar.insertBefore(closeBtn, optionBar.firstChild);
    }
    
    // Fun√ß√£o para fechar
    closeBtn.addEventListener('click', () => {
      optionBar.classList.remove('open');
      overlay.classList.remove('show');
    });
  }
});

</script>

<script src="./src/js/search.js"></script>
<script type="module" src="./src/js/search.js"></script>
<script src="./src/js/more.js"></script>
<script type="module" src="./src/js/loading.js"></script>
<script type="module" src="./src/js/navbar.js" defer></script>
<script type="module" src="./src/js/global-messages.js"></script>
</body>
</html>